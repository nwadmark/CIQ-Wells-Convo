<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cisco Customer Intelligence ‚Äì Wells Fargo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        /* Animated gradient background */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(74, 144, 226, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
            animation: gradient 20s ease infinite;
            z-index: 0;
        }

        @keyframes gradient {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(5%, -5%) rotate(120deg); }
            66% { transform: translate(-5%, 5%) rotate(240deg); }
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 900px;
            position: relative;
            z-index: 1;
        }

        .header {
            background: linear-gradient(135deg, rgba(30, 30, 45, 0.8) 0%, rgba(20, 20, 30, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            color: white;
            padding: 32px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .brand-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4A90E2 0%, #6366F1 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 20px;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        }

        .brand-text h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .brand-text p {
            font-size: 13px;
            opacity: 0.6;
            font-weight: 400;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: #10b981;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .reset-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
        }

        .reset-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .reset-btn:active {
            transform: translateY(0);
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            background: transparent;
        }

        .message {
            margin-bottom: 32px;
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }

        .assistant .avatar {
            background: linear-gradient(135deg, #4A90E2 0%, #6366F1 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .user .avatar {
            background: linear-gradient(135deg, #EC4899 0%, #F97316 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
        }

        .role-label {
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: -0.01em;
        }

        .message-time {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 400;
        }

        .message-bubble {
            padding: 20px 24px;
            border-radius: 16px;
            max-width: 85%;
            line-height: 1.7;
            font-size: 14.5px;
            font-weight: 400;
            position: relative;
        }

        .assistant .message-bubble {
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            color: rgba(255, 255, 255, 0.95);
            margin-left: 48px;
            border-top-left-radius: 4px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .user .message-bubble {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(249, 115, 22, 0.15) 100%);
            border: 1px solid rgba(236, 72, 153, 0.2);
            color: rgba(255, 255, 255, 0.95);
            margin-left: auto;
            margin-right: 0;
            border-top-right-radius: 4px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .user .message-header {
            justify-content: flex-end;
        }

        .user .message-bubble {
            text-align: right;
        }

        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 16px;
            margin-left: 48px;
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .suggestion-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .suggestion-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3) 0%, rgba(74, 144, 226, 0.3) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .suggestion-btn:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .suggestion-btn:hover::before {
            opacity: 1;
        }

        .suggestion-btn:active {
            transform: translateY(0);
        }

        .suggestion-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: inline-flex;
            gap: 6px;
            padding: 20px 24px;
            background: linear-gradient(135deg, rgba(74, 144, 226, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 16px;
            border-top-left-radius: 4px;
            margin-bottom: 32px;
            margin-left: 48px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
                transform: translateY(0);
            }
            30% {
                opacity: 1;
                transform: translateY(-8px);
            }
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.15);
            background-clip: padding-box;
        }

        /* Smooth scroll */
        .chat-container {
            scroll-behavior: smooth;
        }

        .input-area {
            padding: 24px 40px;
            background: linear-gradient(135deg, rgba(30, 30, 45, 0.8) 0%, rgba(20, 20, 30, 0.9) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            padding: 14px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .message-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .message-input:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .send-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #4A90E2 0%, #6366F1 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
            white-space: nowrap;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .send-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info-message {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: rgba(255, 255, 255, 0.9);
            padding: 16px 20px;
            border-radius: 12px;
            margin-top: 12px;
            font-size: 13px;
            line-height: 1.6;
        }

        .info-message strong {
            color: #fbbf24;
            display: block;
            margin-bottom: 4px;
        }

        .mic-btn {
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .mic-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(99, 102, 241, 0.5);
            color: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }

        .mic-btn:active:not(:disabled) {
            transform: translateY(0);
        }

        .mic-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .mic-btn.recording {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            border-color: #EF4444;
            color: white;
            animation: pulse-mic 1.5s ease-in-out infinite;
        }

        @keyframes pulse-mic {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }

        .voice-status {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            font-weight: 500;
        }

        .voice-status.recording {
            color: #EF4444;
        }

        /* ‚îÄ‚îÄ‚îÄ Persona Tab Bar ‚îÄ‚îÄ‚îÄ */
        .persona-tabs {
            display: flex;
            gap: 0;
            background: rgba(15, 15, 25, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            padding: 0 24px;
            flex-shrink: 0;
        }

        .persona-tab {
            padding: 12px 20px;
            font-size: 13px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.45);
            cursor: pointer;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            transition: all 0.25s ease;
            font-family: 'Inter', sans-serif;
            white-space: nowrap;
        }

        .persona-tab:hover {
            color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.03);
        }

        .persona-tab.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
            background: rgba(96, 165, 250, 0.05);
        }

        /* ‚îÄ‚îÄ‚îÄ Proactive Insight Panel ‚îÄ‚îÄ‚îÄ */
        .attention-panel {
            background: linear-gradient(135deg, rgba(20, 20, 35, 0.95) 0%, rgba(15, 15, 28, 0.98) 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            padding: 16px 24px;
            overflow-x: auto;
            flex-shrink: 0;
        }

        .attention-panel-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.5);
        }

        .attention-panel-header span.pulse-dot {
            width: 6px;
            height: 6px;
            background: #ef4444;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s ease-in-out infinite;
        }

        .attention-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .attention-card {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 14px 16px;
            border-left: 3px solid transparent;
            cursor: default;
            transition: background 0.2s ease, border-color 0.2s ease;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .attention-card:hover {
            background: rgba(255, 255, 255, 0.07);
        }

        .attention-card.severity-critical { border-left-color: #ef4444; }
        .attention-card.severity-misconfig { border-left-color: #eab308; }
        .attention-card.severity-support  { border-left-color: #3b82f6; }
        .attention-card.severity-renewal  { border-left-color: #a855f7; }

        .attention-card .card-icon {
            font-size: 18px;
            line-height: 1;
        }

        .attention-card .card-headline {
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            line-height: 1.3;
        }

        .attention-card .card-summary {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.55);
            line-height: 1.4;
        }

        .attention-card .card-action {
            margin-top: 4px;
            padding: 5px 12px;
            font-size: 11px;
            font-weight: 600;
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.25);
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s ease, color 0.2s ease;
            align-self: flex-start;
        }

        .attention-card .card-action:hover {
            background: rgba(96, 165, 250, 0.2);
            color: #93c5fd;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .container {
                max-height: 95vh;
                border-radius: 16px;
            }

            .header {
                padding: 24px 20px;
            }

            .brand-icon {
                width: 40px;
                height: 40px;
                font-size: 18px;
            }

            .brand-text h1 {
                font-size: 18px;
            }

            .chat-container {
                padding: 24px 20px;
            }

            .message-bubble {
                max-width: 90%;
            }

            .suggestions {
                margin-left: 0;
            }

            .typing-indicator {
                margin-left: 0;
            }

            .input-area {
                padding: 16px 20px;
                gap: 8px;
            }

            .send-btn {
                padding: 14px 20px;
            }

            .mic-btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .voice-status {
                font-size: 10px;
                bottom: -20px;
            }

            .persona-tabs {
                padding: 0 16px;
                overflow-x: auto;
            }

            .persona-tab {
                padding: 10px 14px;
                font-size: 12px;
            }

            .attention-cards {
                grid-template-columns: 1fr 1fr;
            }

            .attention-panel {
                padding: 12px 16px;
            }
        }

        /* ‚îÄ‚îÄ‚îÄ Quick Action Bar ‚îÄ‚îÄ‚îÄ */
        .quick-actions {
            display: flex;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(10, 10, 18, 0.6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            overflow-x: auto;
            flex-shrink: 0;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .quick-actions::-webkit-scrollbar {
            display: none;
        }

        .quick-action-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        .quick-action-pill:hover {
            background: rgba(99, 102, 241, 0.15);
            border-color: rgba(99, 102, 241, 0.3);
            color: rgba(255, 255, 255, 0.95);
            transform: translateY(-1px);
        }

        .quick-action-pill:active {
            transform: translateY(0);
        }

        @media (max-width: 480px) {
            .attention-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="brand">
                    <div class="brand-icon">C</div>
                    <div class="brand-text">
                        <h1>Cisco Customer Intelligence</h1>
                        <p>Wells Fargo Network Operations</p>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        <span>Connected</span>
                    </div>
                    <button class="reset-btn" onclick="resetChat()">Reset</button>
                </div>
            </div>
        </div>
        <!-- Persona Tab Bar -->
        <div class="persona-tabs" id="personaTabs">
            <button class="persona-tab active" data-persona="engineer" onclick="switchViewPersona('engineer')">üõ† Network Engineer</button>
            <button class="persona-tab" data-persona="director" onclick="switchViewPersona('director')">üìä IT Director</button>
            <button class="persona-tab" data-persona="partner" onclick="switchViewPersona('partner')">ü§ù Partner / CSM</button>
        </div>

        <!-- Proactive Insight Panel -->
        <div class="attention-panel" id="attentionPanel">
            <div class="attention-panel-header">
                <span class="pulse-dot"></span>
                Proactive Insights ‚Äî Items Requiring Attention
            </div>
            <div class="attention-cards" id="attentionCards">
                <!-- Cards populated by JS from ciscoIQData -->
            </div>
        </div>

        <!-- Quick Action Bar -->
        <div class="quick-actions">
            <button class="quick-action-pill" onclick="handleAttentionClick('What misconfigurations were found in the last assessment?')">üîç Run Assessment</button>
            <button class="quick-action-pill" onclick="handleAttentionClick('Give me a security posture summary')">üõ° Security Briefing</button>
            <button class="quick-action-pill" onclick="handleAttentionClick('Show me all open TAC cases')">üìã Open Cases</button>
            <button class="quick-action-pill" onclick="handleAttentionClick('What are the most critical vulnerabilities right now?')">‚ö†Ô∏è Critical Alerts</button>
            <button class="quick-action-pill" onclick="handleAttentionClick('What contracts are expiring in the next 90 days?')">üìÖ Renewal Risk</button>
        </div>

        <div class="chat-container" id="chatContainer">
            <!-- Messages will be inserted here -->
        </div>
        <div class="input-area">
            <div class="input-wrapper">
                <input
                    type="text"
                    id="messageInput"
                    class="message-input"
                    placeholder="Ask me anything about your network, security, or infrastructure..."
                    autocomplete="off"
                />
            </div>
            <button id="micBtn" class="mic-btn" onclick="toggleVoiceInput()" title="Click to speak">
                <span id="micIcon">üé§</span>
                <div id="voiceStatus" class="voice-status" style="display: none;"></div>
            </button>
            <button id="sendBtn" class="send-btn" onclick="sendCustomMessage()">Send</button>
        </div>
    </div>

    <script>
        // ‚îÄ‚îÄ‚îÄ Cisco IQ Simulated Network Operational Data (Wells Fargo) ‚îÄ‚îÄ‚îÄ
        const ciscoIQData = {
            assets: [
                { name: "WF-RTR-CLT-01", type: "Router", model: "Cisco ASR 1006-X", datacenter: "Charlotte", healthScore: 92, lifecycleStatus: "Active" },
                { name: "WF-RTR-CLT-02", type: "Router", model: "Cisco ASR 1002-HX", datacenter: "Charlotte", healthScore: 87, lifecycleStatus: "Active" },
                { name: "WF-SW-CLT-01", type: "Switch", model: "Cisco Catalyst 9300", datacenter: "Charlotte", healthScore: 78, lifecycleStatus: "Active" },
                { name: "WF-FW-CLT-01", type: "Firewall", model: "Cisco Firepower 4125", datacenter: "Charlotte", healthScore: 95, lifecycleStatus: "Active" },
                { name: "WF-RTR-MSP-01", type: "Router", model: "Cisco ASR 9001", datacenter: "Minneapolis", healthScore: 64, lifecycleStatus: "End of Sale" },
                { name: "WF-SW-MSP-01", type: "Switch", model: "Cisco Catalyst 9500", datacenter: "Minneapolis", healthScore: 91, lifecycleStatus: "Active" },
                { name: "WF-FW-MSP-01", type: "Firewall", model: "Cisco ASA 5545-X", datacenter: "Minneapolis", healthScore: 53, lifecycleStatus: "End of Life" },
                { name: "WF-SW-MSP-02", type: "Switch", model: "Cisco Nexus 9336C-FX2", datacenter: "Minneapolis", healthScore: 88, lifecycleStatus: "Active" },
                { name: "WF-RTR-SFO-01", type: "Router", model: "Cisco ISR 4461", datacenter: "San Francisco", healthScore: 71, lifecycleStatus: "Active" },
                { name: "WF-SW-SFO-01", type: "Switch", model: "Cisco Catalyst 9200", datacenter: "San Francisco", healthScore: 46, lifecycleStatus: "End of Life" },
                { name: "WF-FW-SFO-01", type: "Firewall", model: "Cisco Firepower 2130", datacenter: "San Francisco", healthScore: 83, lifecycleStatus: "Active" },
                { name: "WF-SW-SFO-02", type: "Switch", model: "Cisco Nexus 93180YC-FX", datacenter: "San Francisco", healthScore: 69, lifecycleStatus: "End of Sale" }
            ],

            vulnerabilities: [
                { cveId: "CVE-2024-20353", severity: "Critical", affectedDevices: ["WF-FW-CLT-01", "WF-FW-SFO-01"], daysOpen: 42, recommendedFix: "Upgrade to FTD 7.4.1.1 or apply hotfix cisco-sa-asaftd-websrvs-dos" },
                { cveId: "CVE-2024-20359", severity: "Critical", affectedDevices: ["WF-FW-MSP-01"], daysOpen: 38, recommendedFix: "Migrate from ASA 5545-X to Firepower 4100; device is End of Life" },
                { cveId: "CVE-2023-20198", severity: "Critical", affectedDevices: ["WF-SW-CLT-01", "WF-SW-SFO-01", "WF-RTR-SFO-01"], daysOpen: 127, recommendedFix: "Upgrade IOS-XE to 17.9.4a or later; disable HTTP/HTTPS server if unused" },
                { cveId: "CVE-2024-20356", severity: "High", affectedDevices: ["WF-SW-MSP-02", "WF-SW-SFO-02"], daysOpen: 29, recommendedFix: "Apply NX-OS patch 10.4(2) and restrict CIMC access to management VLAN" },
                { cveId: "CVE-2024-20291", severity: "High", affectedDevices: ["WF-RTR-CLT-01", "WF-RTR-CLT-02", "WF-RTR-MSP-01"], daysOpen: 55, recommendedFix: "Upgrade to IOS-XE 17.12.3 or apply ACL hardening per PSIRT advisory" },
                { cveId: "CVE-2023-20273", severity: "High", affectedDevices: ["WF-SW-CLT-01", "WF-SW-SFO-01"], daysOpen: 112, recommendedFix: "Upgrade IOS-XE to 17.9.4a; rotate local credentials on affected switches" },
                { cveId: "CVE-2024-20379", severity: "Medium", affectedDevices: ["WF-FW-MSP-01", "WF-FW-CLT-01"], daysOpen: 18, recommendedFix: "Disable WebVPN customization or upgrade to ASA 9.18(4.22)" },
                { cveId: "CVE-2024-20314", severity: "Medium", affectedDevices: ["WF-RTR-SFO-01"], daysOpen: 34, recommendedFix: "Upgrade IOS-XE to 17.11.1a; limit SSH access to jump hosts only" }
            ],

            security: {
                postureScore: 67,
                postureMax: 100,
                recentAnomalies: [
                    { description: "Unusual East-West traffic spike on MPLS backbone between Charlotte and Minneapolis DCs", detectedDate: "2026-02-22", severity: "High" },
                    { description: "Repeated failed TACACS+ authentication attempts from WF-SW-SFO-01 to ISE cluster", detectedDate: "2026-02-24", severity: "Medium" },
                    { description: "Unexpected BGP route advertisement from WF-RTR-MSP-01 leaking internal prefixes to DMZ segment", detectedDate: "2026-02-20", severity: "Critical" }
                ],
                compliance: {
                    pciDss: { status: "Non-Compliant", findings: 4, details: "Open findings on firewall rule review cadence and encrypted key management" },
                    sox: { status: "Compliant with Exceptions", findings: 2, details: "Two change-management audit gaps in Minneapolis DC switch configs" }
                }
            },

            assessments: {
                lastAssessmentDate: "2026-02-10",
                misconfigurations: [
                    { deviceName: "WF-SW-CLT-01", issue: "Telnet enabled on management interface; SSH-only policy violated", riskLevel: "High" },
                    { deviceName: "WF-FW-MSP-01", issue: "Default SNMP community string 'public' still configured", riskLevel: "Critical" },
                    { deviceName: "WF-RTR-SFO-01", issue: "NTP configured with unauthenticated public servers instead of internal stratum-1", riskLevel: "Medium" },
                    { deviceName: "WF-SW-SFO-02", issue: "Spanning-tree PortFast enabled on uplink trunk ports", riskLevel: "High" },
                    { deviceName: "WF-RTR-CLT-02", issue: "OSPF adjacency using plaintext authentication instead of MD5", riskLevel: "Medium" }
                ],
                configDriftCount: 23
            },

            supportCases: [
                { caseNumber: "SR-694281037", title: "Firepower 4125 intermittent packet drops on TLS 1.3 inspection", severity: "S1", daysOpen: 3, status: "Customer Updated", assignedEngineer: "Rajesh Krishnamurthy" },
                { caseNumber: "SR-694277814", title: "ASR 1006-X memory leak in QoS policy-map after IOS-XE 17.11 upgrade", severity: "S2", daysOpen: 11, status: "Pending Engineering", assignedEngineer: "Maria Santos" },
                { caseNumber: "SR-694265590", title: "Catalyst 9300 stack ring failure on switch 3 of 8", severity: "S2", daysOpen: 18, status: "Workaround Provided", assignedEngineer: "David Chen" },
                { caseNumber: "SR-694259183", title: "ISE 3.3 posture policy not enforcing on 802.1X re-auth for Nexus 9336C", severity: "S3", daysOpen: 26, status: "Pending Customer", assignedEngineer: "Anil Mehta" },
                { caseNumber: "SR-694250741", title: "SD-WAN vManage certificate renewal failing across Minneapolis hub", severity: "S2", daysOpen: 34, status: "Escalated to BU", assignedEngineer: "Jennifer Walsh" },
                { caseNumber: "SR-694243298", title: "Nexus 93180YC-FX CoPP policy drops legitimate SNMP polling in SFO DC", severity: "S4", daysOpen: 45, status: "Solution Provided", assignedEngineer: "Thomas Rivera" }
            ],

            renewals: [
                { contractId: "CON-SNT-WF-2024-0871", productName: "Cisco DNA Advantage ‚Äî Catalyst 9300/9500 (217 licenses)", expiryDate: "2026-04-15", annualValue: 1243000 },
                { contractId: "CON-ECMU-WF-2024-0344", productName: "Cisco Secure Firewall Threat Defense ‚Äî Firepower 4100 Series", expiryDate: "2026-03-28", annualValue: 487500 },
                { contractId: "CON-SNT-WF-2024-0592", productName: "Cisco Smart Net Total Care ‚Äî ASR 1000 Series Routers", expiryDate: "2026-05-01", annualValue: 329000 },
                { contractId: "CON-SAU-WF-2024-0118", productName: "Cisco ThousandEyes ‚Äî Enterprise Agent (85 agents)", expiryDate: "2026-04-07", annualValue: 178500 }
            ]
        };

        // ‚îÄ‚îÄ‚îÄ View Persona State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let activeViewPersona = 'engineer';

        const viewPersonaConfig = {
            engineer: {
                greeting: "Good morning. I've scanned 12 devices across your environment. You have 3 critical CVEs, including one open 127 days. Want me to walk you through remediation priorities?",
                suggestions: ["Show me the CVEs", "Check device health", "What needs my attention"],
                mappedPersona: "Network Ops (Global)"
            },
            director: {
                greeting: "Good morning. Your security posture is 67/100. You have $2.24M in contracts expiring in 90 days and one S2 case approaching SLA breach. Want an executive summary?",
                suggestions: ["Executive summary", "Show contract risk", "Review security posture"],
                mappedPersona: "Executive Overview"
            },
            partner: {
                greeting: "Good morning. Wells Fargo has 3 critical vulnerabilities and an S2 case escalated to BU. Two renewal opportunities total $876K. Want to review customer health?",
                suggestions: ["Review customer health", "Show renewal opportunities", "Check open escalations"],
                mappedPersona: "Procurement / Asset Mgmt"
            }
        };

        // Returns the appropriate string for the active view persona
        function _tone(eng, dir, csm) {
            if (activeViewPersona === 'director') return dir;
            if (activeViewPersona === 'partner') return csm;
            return eng;
        }

        let currentPersona = null;
        let personaConversations = {};

        // Network Ops Persona
        personaConversations["Network Ops (Global)"] = [
            {
                role: "assistant",
                text: "Great. I've loaded your global Network Ops view. Where should I deliver critical alerts (outages, PSIRTs, EOL/EOS, contract risk)?",
                suggestions: ["Webex + Email", "Teams only", "Email only"]
            },
            { role: "user", text: "Webex + Email" },
            {
                role: "assistant",
                text: "Done. Here's your live dashboard: Uptime 99.94% (30d). 46 branches near WAN saturation. 3 critical PSIRTs impact 217 devices (Catalyst 9300, ASA 5516, FXOS). 5 contracts expire in 60 days. 12 licenses over-allocated. 14 EOL devices in production. What do you want to tackle first?",
                suggestions: ["PSIRTs first", "Branch capacity risks", "Contracts & Licenses"]
            },
            { role: "user", text: "PSIRTs first" },
            {
                role: "assistant",
                text: "Security Advisories mapped to your assets: ‚Ä¢ IOS-XE on C9300 ‚Äî 143 devices. Fix: 17.9.5a. ‚Ä¢ ASA 5516 ‚Äî 38 appliances. Fix: migrate to FTD or 9.16(5)27. ‚Ä¢ FXOS ‚Äî 36 chassis. Fix: 2.14(1f). Want me to draft change plans, stage a pilot, or export to ServiceNow?",
                suggestions: ["Stage pilot in lab", "Draft change plan", "Export to ServiceNow"]
            },
            { role: "user", text: "Stage pilot in lab" },
            {
                role: "assistant",
                text: "Proposed pilot rings and windows: Ring 0 (2 low-risk branches: Sacramento, Tempe), Ring 1 (5 regional offices), Ring 2 (SF/Charlotte hubs). Maintenance Tue/Thu 01:00‚Äì03:00 local. Proceed or customize?",
                suggestions: ["Use suggested rings & windows", "Customize rings", "Cancel"]
            },
            { role: "user", text: "Use suggested rings & windows" },
            {
                role: "assistant",
                text: "Pilots scheduled. I've posted runbooks to your Webex 'NetOps-Change' space and opened a ServiceNow CR with rollback, pre/post checks, and CAB notes. Include automated health baselines (CPU/mem, interface errors, syslogs) in the CR?",
                suggestions: ["Yes, attach baselines", "No, keep lean"]
            },
            { role: "user", text: "Yes, attach baselines" },
            {
                role: "assistant",
                text: "Attached. Next, Branch capacity: 46 sites at risk. Top 3: Daly City (92% peak, LTE flaps), Austin Domain (QoS misclassifies Zoom/Webex), Newark (1Gb DIA, +18% MoM growth; saturation in 19 days). Recommended: increase CIR Daly City, fix QoS, order 2Gb DIA for Newark with temporary SaaS breakout. What should we do?",
                suggestions: ["Apply QoS template now", "Open carrier quote", "Create SD-WAN policy change"]
            },
            { role: "user", text: "Apply QoS template now" },
            {
                role: "assistant",
                text: "Previewing config via Cisco DNA Center: Apply 'WF-QoS-Branch-v7' to Austin Domain. Impact: +1 class-map, +1 policy-map, no reload. See diff or proceed?",
                suggestions: ["Show diff", "Proceed", "Schedule tonight"]
            },
            { role: "user", text: "Show diff" },
            {
                role: "assistant",
                text: "Diff: - class-map VIDEO-OLD; + class-map COLLAB-REALTIME (match dscp cs4 ef); + policy WAN-OUT priority percent 30 for COLLAB-REALTIME. Voice VLAN unaffected. Proceed?",
                suggestions: ["Proceed", "Schedule tonight"]
            },
            { role: "user", text: "Proceed" },
            {
                role: "assistant",
                text: "Template applied. Post-checks green: MOS +0.4, jitter ‚àí8ms. Notify branch manager and attach results to the Austin ticket?",
                suggestions: ["Yes", "No"]
            },
            { role: "user", text: "Yes" },
            {
                role: "assistant",
                text: "Done. Proactive care items: ‚Ä¢ SmartNet for 120 Catalyst 9K in Southeast expires in 60 days. ‚Ä¢ Umbrella SIG license pool at 95% utilization. ‚Ä¢ Predicted RMA: 3 fans on C9500-24Y (Charlotte) trending to failure. Open cases?",
                suggestions: ["Open all cases", "Open RMA only", "Skip for now"]
            },
            { role: "user", text: "Open all cases" },
            {
                role: "assistant",
                text: "Opened: renewal quote (1/3/5-yr with co-term), license right-size (reclaim 320 inactive; add 500 SIG temps), RMA advanced replacement for 3 fans tomorrow 10:00. Route quotes to Procurement and Finance for approval?",
                suggestions: ["Yes, route for approval", "Send to Procurement only", "I'll handle approvals"]
            },
            { role: "user", text: "Yes, route for approval" },
            {
                role: "assistant",
                text: "Routed with 48/24/4-hour SLA nudges. Want an executive one-pager (risk, savings, outcomes) for NetOps leadership?",
                suggestions: ["Yes, create one-pager", "No, skip"]
            },
            { role: "user", text: "Yes, create one-pager" },
            {
                role: "assistant",
                text: "Executive brief ready: PSIRT exposure projected ‚àí74% post-rollout; license reclaim saves ~$184k; WAN uplift +$62k offset by productivity. Delivered to Webex 'NetOps-Leadership' and email. Run a quick SOX/PCI compliance scan before the next audit window?",
                suggestions: ["Run compliance scan", "Later"]
            },
            { role: "user", text: "Run compliance scan" },
            {
                role: "assistant",
                text: "Compliance findings: ‚Ä¢ PCI: 12 branches using WPA2-PSK on guest; recommend WPA3 + unique PSKs via ISE. ‚Ä¢ SOX: 4 devices missing AAA accounting to TACACS. ‚Ä¢ Config drift: 22 switches off 'WF-Std-Access-23b'. Open remediation tasks with golden-config diffs?",
                suggestions: ["Open tasks", "Export report only"]
            },
            { role: "user", text: "Open tasks" },
            {
                role: "assistant",
                text: "Tasks created in ServiceNow with owner groups (Wireless, Access, Identity) and change windows aligned to audit calendar. Switch to Data Center posture?",
                suggestions: ["Yes, show ACI posture", "Skip for now"]
            },
            { role: "user", text: "Yes, show ACI posture" },
            {
                role: "assistant",
                text: "ACI Fabric-03: Leaf TCAM at 72%, trending 85% in ~6 months. Options: add 2 leafs; or quick cleanup (prune 318 unused filters, 41 stale contracts) to free ~9‚Äì12%. Which path?",
                suggestions: ["Quick cleanup", "Build capacity plan", "Defer"]
            },
            { role: "user", text: "Quick cleanup" },
            {
                role: "assistant",
                text: "Dry-run completed. Schedule cleanup Fri 02:00 local? I'll snapshot before/after and archive to Splunk + evidence store.",
                suggestions: ["Apply Fri 02:00", "Reschedule", "Cancel"]
            },
            { role: "user", text: "Apply Fri 02:00" },
            {
                role: "assistant",
                text: "Scheduled. Alert: I just detected an issue - Dallas datacenter Nexus 9K spine switch reporting high CoPP (Control Plane Policing) drops and elevated CPU (68%). Suspected protocol storm or misconfiguration. This could impact fabric stability. Want me to file a TAC case immediately?",
                suggestions: ["Yes, file TAC case now", "Let me investigate first", "Just monitor for now"]
            },
            { role: "user", text: "Yes, file TAC case now" },
            {
                role: "assistant",
                text: "Filing TAC case with Cisco... Uploading diagnostics: show tech-support, CoPP stats, CPU history, interface counters, fabric health, recent config changes. Severity: 2 (Critical - production network impacted). Contract: SmartNet 24x7x4. Case created successfully! **TAC Case #: 625847392**. Assigned to: Advanced Services Queue. Estimated response: <2 hours. You'll receive updates via email and Webex. Auto-attach live telemetry stream?",
                suggestions: ["Yes, attach telemetry", "No, manual updates only"]
            },
            { role: "user", text: "Yes, attach telemetry" },
            {
                role: "assistant",
                text: "Telemetry stream attached to TAC case 625847392. TAC engineer will have real-time access to: CPU/memory graphs, interface statistics, syslogs, SNMP traps, and fabric analytics. I'll monitor the case and notify you of any TAC updates or recommended actions. Meanwhile, Collaboration note: two CUCM clusters are one minor behind standard; propose rolling upgrades with zero-touch user impact. Proceed or defer?",
                suggestions: ["Plan upgrades", "Defer 30 days"]
            },
            { role: "user", text: "Defer 30 days" },
            {
                role: "assistant",
                text: "Acknowledged. I'll remind you two weeks before the deferral ends. Would you like an Executive Overview now or check license health?",
                suggestions: ["Show Executive Overview", "License health", "We're done"]
            },
            { role: "user", text: "Show Executive Overview" },
            {
                role: "assistant",
                text: "Executive Overview: Availability 99.94% (target 99.95%). Risk moving from High‚ÜíMedium after pilots; projected Low post-rollout. Financials: ~$184k/yr savings from license reclaim; WAN spend +$62k offset by productivity gains. 90-day roadmap: PSIRT rollout, ACI cleanup, branch DIA upgrades, compliance closure, CUCM deferred upgrade. Schedule weekly digests and a monthly board-ready PDF?",
                suggestions: ["Yes, both", "Weekly only", "No thanks"]
            },
            { role: "user", text: "Yes, both" },
            {
                role: "assistant",
                text: "Set: Monday 08:00 PT weekly digest and first business day monthly board PDF. Track anything else?",
                suggestions: ["Add SD-WAN user experience", "Track Zero-Trust maturity", "No changes"]
            },
            { role: "user", text: "Add SD-WAN user experience" },
            {
                role: "assistant",
                text: "Added 'End-User Experience' panel (SaaS RTT, loss, app SLOs). I'll alert if any branch fails SLO for 2+ consecutive hours and open proactive tickets. Brief Cisco CSM and account team so they align roadmap and credits?",
                suggestions: ["Yes, brief them", "No"]
            },
            { role: "user", text: "Yes, brief them" },
            {
                role: "assistant",
                text: "Brief sent with links to change plans, approvals, and executive brief. Anything else today?",
                suggestions: ["/priorities", "/what-changed", "File a TAC case", "We're done"]
            },
            { role: "user", text: "File a TAC case" },
            {
                role: "assistant",
                text: "I can file a TAC case for you. What issue are you experiencing? Please describe the problem, affected device(s), and severity level, or I can file for any detected issues in our conversation. Would you like me to:",
                suggestions: ["File for the Nexus 9K issue we found", "Report a different issue", "Never mind"]
            },
            { role: "user", text: "Report a different issue" },
            {
                role: "assistant",
                text: "Got it. For a new issue, I'd collect: Device type/model, problem description, symptoms, troubleshooting steps tried, affected users/sites, and business impact. In production, you'd provide these details via voice or text, and I'd auto-file with diagnostics. For this demo, the Nexus 9K case (TAC #625847392) shows the complete workflow. Ready to continue?",
                suggestions: ["Yes, continue", "Back to main menu"]
            },
            { role: "user", text: "Yes, continue" },
            {
                role: "assistant",
                text: "Perfect. Remember: TAC case #625847392 is monitoring the Dallas Nexus spine issue. You'll get alerts when TAC responds or requests info. Anything else?",
                suggestions: ["/priorities", "We're done"]
            },
            { role: "user", text: "We're done ‚Äî thanks!" },
            {
                role: "assistant",
                text: "Glad to help. I'll keep monitoring and nudging proactively. Ping me anytime with /priorities to reshuffle the roadmap or /what-changed for a daily diff summary."
            }
        ];

        // Security Ops (SOC) Persona
        personaConversations["Security Ops (SOC)"] = [
            {
                role: "assistant",
                text: "Security Operations view loaded. I'm connected to SecureX, Firepower, Umbrella, ISE, and your SIEM. How can I help you today?",
                suggestions: ["Show active threats", "Review security posture", "Check compliance status"]
            },
            { role: "user", text: "Show active threats" },
            {
                role: "assistant",
                text: "Last 24h: 847 threats blocked. Active investigations: 3 medium-priority incidents. ‚Ä¢ Suspicious lateral movement detected: 10.45.22.18 ‚Üí multiple targets (ongoing, quarantined). ‚Ä¢ Phishing campaign targeting Finance dept: 12 emails blocked, 2 delivered (users trained). ‚Ä¢ Umbrella blocked 341 malware callbacks from branch offices. Which incident should we investigate?",
                suggestions: ["Investigate lateral movement", "Review phishing campaign details", "Analyze malware patterns"]
            },
            { role: "user", text: "Investigate lateral movement" },
            {
                role: "assistant",
                text: "Lateral movement analysis: Source 10.45.22.18 (desktop, Charlotte office) attempted SMB connections to 23 servers in 8 minutes. ISE flagged device as non-compliant (outdated AV). Timeline: 03:14 UTC - First connection. 03:18 UTC - ISE quarantine triggered. 03:22 UTC - Device isolated to remediation VLAN. Recommended actions?",
                suggestions: ["Run forensics scan", "Notify user & IT admin", "Create incident ticket"]
            },
            { role: "user", text: "Run forensics scan" },
            {
                role: "assistant",
                text: "Forensics initiated via AMP for Endpoints. Preliminary findings: Scheduled task created 72h ago (suspicious PowerShell). Registry key modified (persistence mechanism). No data exfiltration detected. Machine appears to be initial compromise, not command-and-control. Recommend full reimaging. Create containment playbook?",
                suggestions: ["Yes, create playbook", "Export to SIEM", "Escalate to IR team"]
            },
            { role: "user", text: "Yes, create playbook" },
            {
                role: "assistant",
                text: "Playbook created: 1) Preserve forensic image (AMP), 2) Reimage device, 3) Force password reset for user, 4) Scan all servers in connection attempt list, 5) Review firewall logs for 72h window, 6) Update detection rules. Posted to SecureX 'Incident-Response' workspace and created ServiceNow INC ticket. Deploy playbook now or schedule?",
                suggestions: ["Deploy immediately", "Schedule for off-hours", "Review first"]
            },
            { role: "user", text: "Deploy immediately" },
            {
                role: "assistant",
                text: "Playbook executing. Step 1/6 complete (image preserved). Step 2/6 in progress (SCCM reimage queued). User notified via email. IT admin (Charlotte) assigned ticket. ETA for full completion: 4 hours. Alert me when done or if issues arise?",
                suggestions: ["Yes, alert on completion", "No notifications needed"]
            },
            { role: "user", text: "Yes, alert on completion" },
            {
                role: "assistant",
                text: "Set. Now, security posture update: Firepower detected 3 IPS signatures firing on Internet edge - possible reconnaissance. Umbrella DNS security score: 94/100 (down 2 points from suspicious domain lookups). Zero Trust maturity: 67% - ISE deployment at 89% coverage, MFA at 78% adoption. What should we address?",
                suggestions: ["Investigate reconnaissance activity", "Review suspicious domains", "Improve Zero Trust coverage"]
            },
            { role: "user", text: "Investigate reconnaissance activity" },
            {
                role: "assistant",
                text: "Reconnaissance analysis: 3 external IPs scanning ports 22, 443, 3389 across public-facing assets. Source: 185.220.x.x (Tor exit nodes). Targets: VPN gateways, web servers. No successful connections. Firepower blocked 2,347 attempts in 6h. Pattern matches APT scanning behavior. Recommend geo-blocking or enhanced monitoring?",
                suggestions: ["Enable geo-blocking for Tor", "Create threat hunt", "Just monitor for now"]
            },
            { role: "user", text: "Create threat hunt" },
            {
                role: "assistant",
                text: "Threat hunt initiated: Searching for similar patterns across all perimeter devices (last 30d). Query running against Firewall logs, Proxy logs, VPN auth attempts, and WAF events. Results in ~90 seconds. While that runs, vulnerability update: 14 critical CVEs published this week, 8 apply to your environment (Catalyst, ASA, FMC). Want the breakdown?",
                suggestions: ["Yes, show CVE breakdown", "Skip to hunt results"]
            },
            { role: "user", text: "Yes, show CVE breakdown" },
            {
                role: "assistant",
                text: "Critical CVEs: ‚Ä¢ CVE-2025-12345 (Catalyst 9K): RCE via web UI - 143 devices exposed. Patch: 17.9.5a (available). ‚Ä¢ CVE-2025-12346 (ASA): Authentication bypass - 38 devices. Urgent patch required. ‚Ä¢ CVE-2025-12347 (FMC): Privilege escalation - 4 devices. Workaround: disable guest accounts (applied). Remediation priority?",
                suggestions: ["Patch ASA first (auth bypass)", "Patch Catalyst 9K fleet", "Show me exposure map"]
            },
            { role: "user", text: "Patch ASA first (auth bypass)" },
            {
                role: "assistant",
                text: "Smart choice - auth bypass is highest risk. ASA patching plan: 38 appliances across 12 sites. Downtime per device: ~6 minutes. Suggested sequence: Dev/Test (4 devices) ‚Üí Regional offices (24) ‚Üí HQ datacenters (10). Maintenance window: Sat 02:00-06:00 local per timezone. HA pairs will failover gracefully. Approve plan?",
                suggestions: ["Approve and schedule", "Adjust sequence", "Need executive signoff"]
            },
            { role: "user", text: "Approve and schedule" },
            {
                role: "assistant",
                text: "ASA patching scheduled. Change tickets created in ServiceNow with rollback procedures. Webex notifications sent to SecOps and NetOps teams. Pre-flight checks: config backups, HA sync verification, traffic baselines captured. Threat hunt results are ready - found 7 prior reconnaissance events from same infrastructure. Investigate?",
                suggestions: ["Yes, show details", "Export for later review"]
            },
            { role: "user", text: "Yes, show details" },
            {
                role: "assistant",
                text: "Threat hunt findings: Same Tor infrastructure scanned you 7 times over 30d, escalating in frequency. Targets evolved: early scans hit generic ports; recent scans probed specific Cisco services (SSH on 22, HTTPS on 443). Hypothesis: adversary fingerprinting your environment. No breaches detected. Recommend adding these IPs to global blocklist and enabling Cisco Talos threat feeds?",
                suggestions: ["Yes, enable Talos feeds", "Just block these IPs", "Create watchlist only"]
            },
            { role: "user", text: "Yes, enable Talos feeds" },
            {
                role: "assistant",
                text: "Talos threat intelligence enabled across Firepower, Umbrella, and email security. Auto-blocking configured for high-confidence threats. Retrospective analysis running on 90d of logs. You'll receive a summary of newly-identified threats tomorrow. Compliance check: SOC2 audit is in 3 weeks - security controls at 96% compliance. Review gaps?",
                suggestions: ["Show compliance gaps", "Generate SOC2 report", "We're good for now"]
            },
            { role: "user", text: "Show compliance gaps" },
            {
                role: "assistant",
                text: "Compliance gaps (4% remaining): ‚Ä¢ Log retention: 2 Firepower devices not forwarding to SIEM (config drift). ‚Ä¢ MFA enrollment: 78/100 privileged accounts still on password-only. ‚Ä¢ Encryption: 6 S3 buckets missing encryption-at-rest. ‚Ä¢ Access reviews: 3 quarterly reviews overdue. Priority fix?",
                suggestions: ["Fix log retention now", "Push MFA enrollment", "All critical - create plan"]
            },
            { role: "user", text: "All critical - create plan" },
            {
                role: "assistant",
                text: "Comprehensive remediation plan: Week 1: Fix logging (2h effort), Week 1: MFA enforcement campaign (HR comms + IT enforcement), Week 2: S3 encryption (automated via Terraform), Week 3: Complete access reviews (send reminders to managers). Assigned owners, scheduled check-ins. Slack/Webex updates every 48h. Launch remediation?",
                suggestions: ["Launch now", "Review with CISO first"]
            },
            { role: "user", text: "Launch now" },
            {
                role: "assistant",
                text: "Remediation launched. Tasks assigned in ServiceNow. Kickoff emails sent. Daily standup scheduled in Webex 'SecOps-Compliance' space. I'll monitor progress and escalate blockers. Anything else I can help with today?",
                suggestions: ["Run threat simulation", "Check endpoint health", "We're done"]
            },
            { role: "user", text: "We're done" },
            {
                role: "assistant",
                text: "Great session. I'll keep watch on the playbook execution, ASA patching, and remediation tasks. You'll get alerts on any status changes. Stay secure!"
            }
        ];

        // Procurement / Asset Mgmt Persona
        personaConversations["Procurement / Asset Mgmt"] = [
            {
                role: "assistant",
                text: "Procurement and Asset Management view loaded. I'm tracking 18,642 assets, 347 active contracts, and $47.2M in annual spend. What would you like to focus on?",
                suggestions: ["Contract renewals", "License optimization", "EOL/EOS assets"]
            },
            { role: "user", text: "Contract renewals" },
            {
                role: "assistant",
                text: "Contract renewal pipeline: ‚Ä¢ Expiring in 30 days: 8 contracts ($2.4M total). ‚Ä¢ Expiring in 90 days: 23 contracts ($8.7M). ‚Ä¢ At risk (no PO): 3 contracts ($890K). Top priority: SmartNet for 120 Catalyst 9K switches (expires in 47 days, $423K). Want to see renewal options?",
                suggestions: ["Show SmartNet options", "Review at-risk contracts", "See full 90-day pipeline"]
            },
            { role: "user", text: "Show SmartNet options" },
            {
                role: "assistant",
                text: "SmartNet renewal for 120x Catalyst 9K: ‚Ä¢ Option A: 1-year, $423K (current rate). ‚Ä¢ Option B: 3-year, $1.18M ($393K/yr, 7% discount). ‚Ä¢ Option C: 5-year co-term, $1.85M ($370K/yr, 12.5% discount + simplified renewals). All options include 24x7 support, advance hardware replacement, and software updates. Recommendation?",
                suggestions: ["Go with 5-year co-term", "Need budget approval first", "Compare with competitors"]
            },
            { role: "user", text: "Go with 5-year co-term" },
            {
                role: "assistant",
                text: "Excellent choice - $265K savings over 5 years plus operational efficiency. I've drafted the quote with co-term date aligned to your fiscal year-end. Next steps: 1) Submit for Finance approval, 2) Route to IT Director signoff, 3) Generate PO, 4) Process with Cisco. Shall I route for approvals?",
                suggestions: ["Yes, route for approval", "Add other renewals first", "Let me review quote"]
            },
            { role: "user", text: "Yes, route for approval" },
            {
                role: "assistant",
                text: "Approval workflow initiated: Finance (Sarah Chen) ‚Üí IT Director (Mike Rodriguez) ‚Üí Procurement VP (you). Email notifications sent with cost-benefit analysis attached. SLA: 5 business days per approver. I'll nudge at 3 days if no response. Now, license optimization: I found $637K in savings opportunities. Interested?",
                suggestions: ["Yes, show me", "Later", "Focus on at-risk contracts"]
            },
            { role: "user", text: "Yes, show me" },
            {
                role: "assistant",
                text: "License optimization opportunities: ‚Ä¢ Umbrella SIG: 820 inactive licenses ($246K/yr waste). Recommend reclaim + rightsize. ‚Ä¢ DNA Advantage: 45 excess licenses ($89K/yr). ‚Ä¢ Webex Calling: 127 licenses unused for 6+ months ($38K/yr). ‚Ä¢ Duo MFA: True-up shows 200 over-deployment ($42K/yr). ‚Ä¢ Meraki LIC: 67 cameras decommissioned, still licensed ($18K/yr). Total potential savings: $433K annually. Start with Umbrella?",
                suggestions: ["Optimize Umbrella first", "Reclaim all inactive licenses", "Show me true-up details"]
            },
            { role: "user", text: "Optimize Umbrella first" },
            {
                role: "assistant",
                text: "Umbrella SIG deep-dive: 2,180 licenses purchased. 1,360 actively used. 820 inactive (users terminated or not consuming). Recommendation: Reclaim 820, purchase 200 additional for growth = net 620 reduction. New annual cost: $1.78M (was $2.03M). Savings: $246K/yr. I can auto-submit license adjustment to Cisco Smart Licensing portal. Proceed?",
                suggestions: ["Yes, submit adjustment", "Verify inactive list first", "Talk to IT first"]
            },
            { role: "user", text: "Yes, submit adjustment" },
            {
                role: "assistant",
                text: "License adjustment submitted to Cisco. Confirmation #SL-2025-98472. Reclaimed licenses will be available for reallocation in 24-48h. Finance will see credit on next invoice (~$20.5K monthly reduction). Moving to DNA Advantage: 345 licensed, 300 actively used. Same approach - reclaim excess?",
                suggestions: ["Yes, reclaim DNA excess", "Hold DNA licenses for projects", "Skip to Webex"]
            },
            { role: "user", text: "Yes, reclaim DNA excess" },
            {
                role: "assistant",
                text: "DNA Advantage: Reclaiming 45 excess licenses. Annual savings: $89K. Adjustment submitted (SL-2025-98473). Cumulative savings so far: $335K/yr. Now EOL/EOS tracking: 67 devices hit End-of-Life status, 22 hit End-of-Support in next 6 months. Budget impact: $1.8M for refresh. Want the breakdown by device type?",
                suggestions: ["Show EOL breakdown", "What's the refresh priority?", "Compare refresh vs extend support"]
            },
            { role: "user", text: "Show EOL breakdown" },
            {
                role: "assistant",
                text: "EOL/EOS breakdown: ‚Ä¢ Catalyst 3750X: 28 switches (EOS Jun 2025). Refresh cost: $420K. ‚Ä¢ ASA 5515: 18 firewalls (EOL now). Refresh to FTD: $675K. ‚Ä¢ UCS C220 M4: 14 servers (EOS Aug 2025). Refresh cost: $385K. ‚Ä¢ Nexus 5548: 7 switches (EOL now). Move to 9K: $320K. Total: $1.8M. I can create refresh roadmap with phased budget approach. Interested?",
                suggestions: ["Yes, create roadmap", "Explore extended support costs", "Just replace critical (ASA, Nexus)"]
            },
            { role: "user", text: "Yes, create roadmap" },
            {
                role: "assistant",
                text: "Phased refresh roadmap: Q1 2025: ASA ‚Üí FTD migration ($675K) - highest security risk. Q2 2025: Nexus 5K ‚Üí 9K ($320K) - performance bottleneck. Q3 2025: Catalyst 3750X ‚Üí 9200 ($420K) - before EOS. Q4 2025: UCS refresh ($385K) - aligned to HW budget cycle. Spread across 4 quarters, eases cash flow. Create budget request?",
                suggestions: ["Yes, create budget request", "Adjust phasing", "Can we lease instead?"]
            },
            { role: "user", text: "Yes, create budget request" },
            {
                role: "assistant",
                text: "Budget request created: $1.8M capex across 4 quarters with detailed justification (security risk, support costs, performance needs, compliance). Includes ROI analysis showing $240K/yr opex reduction (fewer failures, better efficiency). Attachments: TCO model, vendor quotes, risk assessment. Route to CFO?",
                suggestions: ["Yes, send to CFO", "Add to capital planning meeting", "Let me review first"]
            },
            { role: "user", text: "Yes, send to CFO" },
            {
                role: "assistant",
                text: "Budget request sent to CFO (Jennifer Watson) with cc to IT and Finance leadership. Scheduled 30-min review session in her calendar for next week. Supporting docs attached. Now, vendor spend analysis: Cisco is 64% of network/security budget ($30.2M). Opportunities for consolidation or re-negotiation?",
                suggestions: ["Show vendor diversification options", "Renegotiate Cisco ELA", "Check spend compliance"]
            },
            { role: "user", text: "Renegotiate Cisco ELA" },
            {
                role: "assistant",
                text: "Current Cisco ELA: $30.2M/yr (network, security, collaboration). Contract expires in 14 months. Based on actual consumption vs. purchased licenses, you're over-deployed by 18% (~$5.4M waste annually). Renegotiation strategy: 1) True-up licenses, 2) Co-term everything, 3) Commit to 3yr for deeper discount. Projected new ELA: $26.8M/yr (11% reduction). Engage account team?",
                suggestions: ["Yes, start negotiation", "Get competitive bids first", "Wait until renewal closer"]
            },
            { role: "user", text: "Yes, start negotiation" },
            {
                role: "assistant",
                text: "Outreach sent to Cisco account team requesting ELA optimization discussion. Included consumption data, savings targets, and competitive landscape insights. Meeting request sent for 2 weeks out. I'll prepare negotiation playbook with: current spend, usage data, market benchmarks, walk-away alternatives. Anything else on procurement today?",
                suggestions: ["Review PO status", "Check asset utilization", "We're done"]
            },
            { role: "user", text: "We're done" },
            {
                role: "assistant",
                text: "Great work today! We've saved $433K/yr on licenses, set up $1.8M refresh roadmap, and initiated $3.4M ELA renegotiation. I'll track all approvals and deadlines. See you next time!"
            }
        ];

        // Executive Overview Persona
        personaConversations["Executive Overview"] = [
            {
                role: "assistant",
                text: "Welcome to your Executive Dashboard. I'm aggregating data across all your Cisco systems - networking, security, collaboration, data center. What would you like to see?",
                suggestions: ["Show me KPIs", "What are the top risks?", "Financial summary"]
            },
            { role: "user", text: "Show me KPIs" },
            {
                role: "assistant",
                text: "Key Performance Indicators (Last 30 days): ‚Ä¢ Network Availability: 99.94% (target: 99.95%, miss: -0.01%). ‚Ä¢ Security Posture Score: 87/100 (was 84 last month, +3). ‚Ä¢ Mean Time to Resolve (MTTR): 4.2 hours (target: <4h, miss: +5%). ‚Ä¢ Collaboration Uptime: 99.98% (exceeds target). ‚Ä¢ Incidents: 47 total, 3 critical (down 12% from last month). Drill into any area?",
                suggestions: ["Why did we miss availability target?", "What improved security score?", "Show incident trends"]
            },
            { role: "user", text: "Why did we miss availability target?" },
            {
                role: "assistant",
                text: "Availability gap analysis: Two outages impacted the metric: 1) Austin branch: WAN circuit failed (4h outage, carrier issue, no redundancy). Impact: 300 users, $45K productivity loss. 2) Charlotte datacenter: Planned ACI maintenance overran by 38 minutes (change management issue). Recommendations: Add LTE backup to single-homed branches ($12K/yr), improve change planning rigor. Implement?",
                suggestions: ["Yes, add LTE backup to at-risk sites", "Just fix change management", "Show me cost-benefit"]
            },
            { role: "user", text: "Show me cost-benefit" },
            {
                role: "assistant",
                text: "Cost-benefit analysis: LTE backup for 12 at-risk branches: $12K/yr cost vs. estimated $180K/yr in avoided downtime (4 incidents/yr avg). ROI: 15:1. Payback period: <1 month. Improved change management (training + automation): $25K one-time investment, reduces overruns by ~65%, avoids ~$90K/yr in SLA misses. Combined NPV over 3 years: $687K. Approve investment?",
                suggestions: ["Approve both initiatives", "Just LTE backup", "Need board approval"]
            },
            { role: "user", text: "Approve both initiatives" },
            {
                role: "assistant",
                text: "Approved. I've created project charters for both initiatives and assigned ownership: LTE backup to Network Ops Director, Change Mgmt to IT Operations VP. Budget transferred from contingency fund. Target completion: Q1 2025. You'll get monthly progress updates. Now, top risks across the organization:",
                suggestions: ["Show me top risks", "Skip to financial summary"]
            },
            { role: "user", text: "Show me top risks" },
            {
                role: "assistant",
                text: "Top 5 Enterprise Risks: 1) Security: 8 critical CVEs unpatched (143 devices). Exposure: potential breach. Mitigation: patching in progress (78% complete). 2) Compliance: SOC2 audit in 3 weeks, 96% ready (4% gaps in logging, MFA). Mitigation: remediation plan launched. 3) Capacity: 46 branches near WAN saturation, 19 days until Newark fails. Mitigation: in progress. 4) Financial: $5.4M license over-deployment. Mitigation: reclamation underway. 5) EOL: 67 devices past end-of-life, security/support risk. Mitigation: $1.8M refresh roadmap proposed. Which risk should we discuss?",
                suggestions: ["Dive into security risk", "What's the compliance exposure?", "Show me financial impact"]
            },
            { role: "user", text: "Dive into security risk" },
            {
                role: "assistant",
                text: "Security Risk Deep-Dive: Critical CVE-2025-12346 affects 38 ASA firewalls (authentication bypass). If exploited: full network access, data exfiltration, ransomware deployment. Estimated breach cost: $8.4M (based on industry avg). Current mitigation: IPS signatures deployed (temporary), patching 78% complete, ETA full remediation: 5 days. Residual risk: MEDIUM (down from CRITICAL). Accept residual risk or expedite patching?",
                suggestions: ["Expedite patching to 48h", "Acceptable - continue plan", "What about cyber insurance?"]
            },
            { role: "user", text: "Expedite patching to 48h" },
            {
                role: "assistant",
                text: "Expedited patching approved. I've reallocated resources: 24/7 coverage, parallel execution across timezones. New ETA: 48 hours. Additional cost: $18K (overtime, expedited support). Risk reduced to LOW within 2 days. Security leadership notified. Now, financial summary: Total IT spend under Cisco portfolio: $47.2M/yr. Optimization opportunities identified: $4.1M/yr savings. Breakdown?",
                suggestions: ["Yes, show breakdown", "What's our spend vs budget?", "Compared to industry peers?"]
            },
            { role: "user", text: "Yes, show breakdown" },
            {
                role: "assistant",
                text: "Financial Optimization ($4.1M total): ‚Ä¢ License reclamation: $433K/yr (Umbrella, DNA, Webex, Duo, Meraki). ‚Ä¢ ELA renegotiation: $3.4M/yr (consumption-based pricing, 3-year commit). ‚Ä¢ Reduced incidents (LTE backup): $180K/yr (avoided downtime). ‚Ä¢ Change management efficiency: $90K/yr (fewer SLA misses). Offset by investments: -$12K/yr (LTE), -$25K one-time (training). Net 3-year benefit: $12.1M. Board presentation-ready?",
                suggestions: ["Yes, create board deck", "Add more context", "Show quarterly breakdown"]
            },
            { role: "user", text: "Yes, create board deck" },
            {
                role: "assistant",
                text: "Board presentation created (18 slides): Executive Summary, KPIs & Trends, Risk Dashboard, Security Update, Financial Performance, Optimization Roadmap, Strategic Initiatives, Q&A. Includes visualizations, benchmarks, and forward-looking projections. Exported to PowerPoint and PDF. Delivered to your OneDrive. Present at next board meeting (Jan 15)?",
                suggestions: ["Yes, add to agenda", "Let me review first", "Schedule dry-run"]
            },
            { role: "user", text: "Yes, add to agenda" },
            {
                role: "assistant",
                text: "Added to Jan 15 board agenda (30-min slot). Calendar invite sent to board members with pre-read materials attached. You'll receive briefing notes 48h before the meeting. I'll also prepare backup slides for Q&A. Anything else you need today?",
                suggestions: ["Show workforce/collaboration metrics", "Strategic planning for 2025", "We're done"]
            },
            { role: "user", text: "Show workforce/collaboration metrics" },
            {
                role: "assistant",
                text: "Workforce & Collaboration Metrics: ‚Ä¢ Webex adoption: 87% of workforce (target: 90%). ‚Ä¢ Meeting quality (MOS): 4.2/5.0 (excellent). ‚Ä¢ Collaboration spend per user: $47/month (industry avg: $52). ‚Ä¢ Support tickets: 234 last month (down 18% YoY due to better UX). ‚Ä¢ Mobile usage: 64% of users (up 22% YoY, remote work trend). Opportunities: Push remaining 13% to Webex to decommission legacy tools ($38K/yr savings). Invest in Webex AI features (real-time translation, transcription) for productivity gains?",
                suggestions: ["Drive remaining Webex adoption", "Pilot AI features", "Both"]
            },
            { role: "user", text: "Both" },
            {
                role: "assistant",
                text: "Excellent. Two initiatives launched: 1) Webex Adoption Campaign: HR comms, IT support, legacy tool sunset plan. Target: 90% by end of Q1. Savings: $38K/yr. 2) Webex AI Pilot: 50 users across Sales, Legal, Support for 60 days. Measure productivity impact. Pilot cost: $8K. If successful, full rollout adds $2.40/user/month. Both initiatives tracking in PMO dashboard. Strategic planning next?",
                suggestions: ["Yes, let's discuss 2025 strategy", "We're done for now"]
            },
            { role: "user", text: "Yes, let's discuss 2025 strategy" },
            {
                role: "assistant",
                text: "2025 Strategic Priorities (aligned to company goals): 1) Zero Trust Architecture: Achieve 95% maturity (currently 67%). Investment: $1.2M. Business outcome: reduce breach risk 80%. 2) AI/Automation: Deploy AIOps, auto-remediation. Investment: $450K. Outcome: 40% MTTR reduction. 3) Cloud Migration: Move 60% of workloads to hybrid cloud. Investment: $2.8M (offset by $1.1M datacenter savings). 4) Sustainability: Reduce power consumption 15% via network optimization. Investment: $180K, ROI: $320K/yr. Prioritize or adjust?",
                suggestions: ["This priority order is good", "Move AI/Automation to #1", "Add SASE to the list"]
            },
            { role: "user", text: "This priority order is good" },
            {
                role: "assistant",
                text: "Strategic plan confirmed. Total 2025 investment: $4.63M. Expected ROI: $6.8M over 3 years. I've created project roadmaps, assigned exec sponsors, and set quarterly milestones. You'll receive monthly scorecards tracking progress against KPIs. Final summary: Today we addressed availability, security, compliance, financial optimization, and 2025 strategy. Anything else?",
                suggestions: ["Send me weekly exec digest", "We're done"]
            },
            { role: "user", text: "Send me weekly exec digest" },
            {
                role: "assistant",
                text: "Weekly Executive Digest configured: Every Monday 7:00 AM, you'll receive a summary email with KPIs, risk changes, project status, financial updates, and recommended actions. First digest arrives next Monday. You're all set!"
            }
        ];

        const initialMessage = {
            role: "assistant",
            text: "Welcome to Cisco Customer Intelligence for Wells Fargo. I'm your copilot across your Cisco estate (networking, security, collaboration, data center). Which persona would you like to use today?",
            suggestions: ["Network Ops (Global)", "Security Ops (SOC)", "Procurement / Asset Mgmt", "Executive Overview"]
        };

        let conversation = [];
        let currentStep = 0;
        const chatContainer = document.getElementById('chatContainer');

        // Voice recognition variables
        let recognition = null;
        let isRecording = false;

        // Initialize Web Speech API
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';

                recognition.onstart = function() {
                    isRecording = true;
                    const micBtn = document.getElementById('micBtn');
                    const voiceStatus = document.getElementById('voiceStatus');
                    micBtn.classList.add('recording');
                    voiceStatus.textContent = 'Listening...';
                    voiceStatus.style.display = 'block';
                    voiceStatus.classList.add('recording');
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    const input = document.getElementById('messageInput');
                    input.value = transcript;

                    // Auto-send after a brief delay
                    setTimeout(() => {
                        sendCustomMessage();
                    }, 500);
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    const voiceStatus = document.getElementById('voiceStatus');
                    voiceStatus.textContent = 'Error: ' + event.error;
                    setTimeout(stopVoiceRecording, 2000);
                };

                recognition.onend = function() {
                    stopVoiceRecording();
                };
            } else {
                console.warn('Speech recognition not supported');
                // Disable mic button
                const micBtn = document.getElementById('micBtn');
                if (micBtn) {
                    micBtn.disabled = true;
                    micBtn.title = 'Voice input not supported in this browser';
                }
            }
        }

        function toggleVoiceInput() {
            if (!recognition) {
                alert('Voice input is not supported in your browser. Please use Chrome, Edge, or Safari.');
                return;
            }

            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
            }
        }

        function stopVoiceRecording() {
            isRecording = false;
            const micBtn = document.getElementById('micBtn');
            const voiceStatus = document.getElementById('voiceStatus');
            micBtn.classList.remove('recording');
            voiceStatus.style.display = 'none';
            voiceStatus.classList.remove('recording');
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function showTypingIndicator() {
            const typing = document.createElement('div');
            typing.className = 'typing-indicator';
            typing.innerHTML = '<span></span><span></span><span></span>';
            chatContainer.appendChild(typing);
            scrollToBottom();
            return typing;
        }

        function addMessage(role, text, suggestions = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;

            const avatarLetter = role === 'assistant' ? 'C' : 'W';
            const roleName = role === 'assistant' ? 'Cisco AI Assistant' : 'Wells Fargo Network Ops';

            let html = `
                <div class="message-header">
                    ${role === 'assistant' ? `<div class="avatar">${avatarLetter}</div>` : ''}
                    <div class="role-label">${roleName}</div>
                    <div class="message-time">${getCurrentTime()}</div>
                    ${role === 'user' ? `<div class="avatar">${avatarLetter}</div>` : ''}
                </div>
                <div class="message-bubble">${text}</div>
            `;

            if (suggestions && suggestions.length > 0) {
                html += '<div class="suggestions">';
                suggestions.forEach((suggestion, index) => {
                    html += `<button class="suggestion-btn" onclick="handleSuggestionClick(${index})">${suggestion}</button>`;
                });
                html += '</div>';
            }

            messageDiv.innerHTML = html;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function handleSuggestionClick(suggestionIndex) {
            const allButtons = document.querySelectorAll('.suggestion-btn');
            allButtons.forEach(btn => {
                btn.disabled = true;
            });

            // Check if this is persona selection (no persona set yet)
            if (!currentPersona) {
                const personaName = initialMessage.suggestions[suggestionIndex];
                currentPersona = personaName;
                conversation = personaConversations[personaName];
                currentStep = -1; // Will be incremented to 0

                // Show user selection
                addMessage('user', personaName);

                // Show first message of selected persona
                setTimeout(() => {
                    const typing = showTypingIndicator();
                    setTimeout(() => {
                        typing.remove();
                        const firstMessage = conversation[0];
                        addMessage(firstMessage.role, firstMessage.text, firstMessage.suggestions);
                        currentStep = 0;
                    }, 1200);
                }, 600);
                return;
            }

            // Regular conversation flow
            currentStep++;
            if (currentStep < conversation.length) {
                const userMessage = conversation[currentStep];
                addMessage(userMessage.role, userMessage.text);

                currentStep++;
                if (currentStep < conversation.length) {
                    setTimeout(() => {
                        const typing = showTypingIndicator();
                        setTimeout(() => {
                            typing.remove();
                            const assistantMessage = conversation[currentStep];
                            addMessage(assistantMessage.role, assistantMessage.text, assistantMessage.suggestions);
                        }, 1200);
                    }, 600);
                }
            }
        }

        function resetChat() {
            currentStep = 0;
            currentPersona = viewPersonaConfig[activeViewPersona].mappedPersona;
            conversation = personaConversations[currentPersona] || [];
            chatContainer.innerHTML = '';
            initAttentionPanel();
            initChat();
        }

        // ‚îÄ‚îÄ‚îÄ Data-Driven Response Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const _sevRank = { Critical: 0, High: 1, Medium: 2, Low: 3, S1: 0, S2: 1, S3: 2, S4: 3 };
        function _fmtDollars(v) { return v >= 1000000 ? `$${(v/1000000).toFixed(1)}M` : `$${(v/1000).toFixed(0)}K`; }
        function _daysUntil(dateStr) { return Math.ceil((new Date(dateStr) - new Date()) / 86400000); }

        // ‚îÄ‚îÄ Single-item detail builders (tone-aware) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function _cveDetail(cve) {
            const n = cve.affectedDevices.length;
            const opening = _tone(
                `<strong>${cve.cveId}</strong> is a ${cve.severity}-severity advisory affecting ${n} device${n > 1 ? 's' : ''}, open for ${cve.daysOpen} days.`,
                `<strong>${cve.cveId}</strong> (${cve.severity}) is creating unpatched exposure on ${n} production device${n > 1 ? 's' : ''}. It's been open ${cve.daysOpen} days ‚Äî risk is growing.`,
                `<strong>${cve.cveId}</strong> (${cve.severity}) is impacting ${n} device${n > 1 ? 's' : ''} in the Wells Fargo environment. Open ${cve.daysOpen} days ‚Äî this is a proactive remediation opportunity.`
            );
            const action = _tone(
                `I'd recommend staging a remediation pilot starting with the lowest-risk device. Want me to draft a change plan or export to ServiceNow?`,
                `Leaving this unpatched creates audit exposure and potential operational disruption. Want me to prepare a risk brief with remediation timeline for leadership?`,
                `Helping the customer close this quickly strengthens the relationship. Want me to draft a remediation proposal or schedule a CX review?`
            );
            return `${opening}<br><br>` +
                `‚Ä¢ <strong>Devices:</strong> ${cve.affectedDevices.join(', ')}<br>` +
                `‚Ä¢ <strong>Recommended fix:</strong> ${cve.recommendedFix}<br><br>` +
                action;
        }

        function _caseDetail(sr) {
            const opening = _tone(
                `<strong>TAC Case ${sr.caseNumber}</strong> (${sr.severity}) has been open ${sr.daysOpen} days ‚Äî currently <em>${sr.status}</em>.`,
                `<strong>TAC Case ${sr.caseNumber}</strong> (${sr.severity}) has been open ${sr.daysOpen} days. Status: <em>${sr.status}</em>. ${sr.daysOpen >= 14 ? 'This is approaching SLA risk for your operations team.' : ''}`,
                `<strong>TAC Case ${sr.caseNumber}</strong> (${sr.severity}) is open ${sr.daysOpen} days for Wells Fargo. Status: <em>${sr.status}</em>. ${sr.daysOpen >= 14 ? 'This is a customer satisfaction risk ‚Äî consider a proactive check-in.' : ''}`
            );
            const action = _tone(
                (sr.daysOpen >= 14 ? `This case is aging ‚Äî consider requesting a management escalation or callback. ` : ``) + `Want me to escalate, request a callback, or attach additional diagnostics?`,
                `Want me to prepare an impact summary for leadership or request a management escalation?`,
                `Want me to coordinate with the TAC engineer, or prepare a status update for the customer?`
            );
            return `${opening}<br><br>` +
                `‚Ä¢ <strong>Issue:</strong> ${sr.title}<br>` +
                `‚Ä¢ <strong>Engineer:</strong> ${sr.assignedEngineer}<br><br>` +
                action;
        }

        function _renewalDetail(con) {
            const d = _daysUntil(con.expiryDate);
            const opening = _tone(
                `<strong>${con.contractId}</strong> covers ${con.productName} and expires <strong>${con.expiryDate}</strong> (${d} days remaining).`,
                `<strong>${con.contractId}</strong> ‚Äî ${_fmtDollars(con.annualValue)}/yr ‚Äî expires <strong>${con.expiryDate}</strong> (${d} days). ${d <= 45 ? 'This needs budget authorization soon to avoid a coverage lapse.' : ''}`,
                `<strong>${con.contractId}</strong> is a <strong>${_fmtDollars(con.annualValue)}/yr</strong> renewal opportunity expiring ${con.expiryDate} (${d} days). ${d <= 45 ? 'Proactive outreach now maximizes close rate.' : ''}`
            );
            const action = _tone(
                (d <= 45 ? `This is getting tight ‚Äî I'd recommend generating a renewal quote now. ` : ``) + `Want me to prepare 1/3/5-year co-term options, or route directly to Procurement?`,
                `Want me to model renewal scenarios for budget planning, or route directly for approval?`,
                `Want me to prepare a renewal proposal with co-term savings, or schedule a customer review meeting?`
            );
            return `${opening}<br><br>` +
                `‚Ä¢ <strong>Product:</strong> ${con.productName}<br>` +
                `‚Ä¢ <strong>Annual value:</strong> ${_fmtDollars(con.annualValue)}<br><br>` +
                action;
        }

        function _misconfigDetail(m) {
            const opening = _tone(
                `<strong>${m.deviceName}</strong> has a <strong>${m.riskLevel}</strong>-risk finding from the ${ciscoIQData.assessments.lastAssessmentDate} assessment.`,
                `<strong>${m.deviceName}</strong> has a <strong>${m.riskLevel}</strong>-risk misconfiguration that could create compliance exposure. Detected ${ciscoIQData.assessments.lastAssessmentDate}.`,
                `Assessment on ${ciscoIQData.assessments.lastAssessmentDate} flagged a <strong>${m.riskLevel}</strong>-risk issue on <strong>${m.deviceName}</strong> in the Wells Fargo environment.`
            );
            const action = _tone(
                `Want me to push a remediation config, open a change request, or schedule a maintenance window?`,
                `Want me to quantify the risk exposure and prepare a remediation brief for the team?`,
                `This is a good touchpoint for a config review engagement. Want me to draft a CX proposal?`
            );
            return `${opening}<br><br>` +
                `‚Ä¢ <strong>Issue:</strong> ${m.issue}<br>` +
                `‚Ä¢ <strong>Estate-wide drift:</strong> ${ciscoIQData.assessments.configDriftCount} devices off golden config<br><br>` +
                action;
        }

        // ‚îÄ‚îÄ Category-level builders (tone-aware) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function _vulnCategory() {
            const v = ciscoIQData.vulnerabilities;
            const bySev = { Critical: 0, High: 0, Medium: 0 };
            v.forEach(c => bySev[c.severity] = (bySev[c.severity] || 0) + 1);
            const sorted = [...v].sort((a, b) => (_sevRank[a.severity] - _sevRank[b.severity]) || (b.daysOpen - a.daysOpen));
            const top5 = sorted.slice(0, 5);
            const totalDevices = new Set(v.flatMap(c => c.affectedDevices)).size;

            let html = _tone(
                `You have <strong>${v.length} open CVEs</strong> ‚Äî ${bySev.Critical} critical, ${bySev.High} high, ${bySev.Medium} medium ‚Äî mapped to your device inventory.`,
                `<strong>${bySev.Critical} critical vulnerabilities</strong> are creating unpatched exposure across ${totalDevices} production devices. Total open advisories: ${v.length}.`,
                `Wells Fargo has <strong>${v.length} open CVEs</strong> (${bySev.Critical} critical) affecting ${totalDevices} devices. This is a remediation services opportunity.`
            ) + `<br><br>`;

            top5.forEach(c => {
                html += _tone(
                    `‚Ä¢ <strong>${c.cveId}</strong> (${c.severity}) ‚Äî ${c.affectedDevices.join(', ')}, open ${c.daysOpen}d. Fix: ${c.recommendedFix.split(';')[0]}.<br>`,
                    `‚Ä¢ <strong>${c.cveId}</strong> (${c.severity}) ‚Äî ${c.affectedDevices.length} devices at risk, open ${c.daysOpen}d. Operational impact if exploited.<br>`,
                    `‚Ä¢ <strong>${c.cveId}</strong> (${c.severity}) ‚Äî ${c.affectedDevices.length} devices, open ${c.daysOpen}d. Remediation engagement potential.<br>`
                );
            });

            html += '<br>' + _tone(
                `I'd start with ${sorted[0].cveId} ‚Äî it's been open the longest at ${sorted[0].daysOpen} days. Want me to draft a remediation plan or stage a pilot?`,
                `${sorted[0].cveId} has been open ${sorted[0].daysOpen} days ‚Äî longest exposure window. Want me to prepare a risk brief for leadership?`,
                `${sorted[0].cveId} (${sorted[0].daysOpen} days open) is the top remediation priority. Want me to draft a services proposal for the customer?`
            );
            return html;
        }

        function _securityCategory() {
            const sec = ciscoIQData.security;
            const anomalies = [...sec.recentAnomalies].sort((a, b) => _sevRank[a.severity] - _sevRank[b.severity]);

            let html = _tone(
                `Security posture is <strong>${sec.postureScore}/${sec.postureMax}</strong>, with ${anomalies.length} recent anomalies and compliance gaps in both PCI-DSS and SOX.`,
                `Security posture is <strong>${sec.postureScore}/${sec.postureMax}</strong> ‚Äî below the 75-point target. Compliance gaps in PCI-DSS and SOX create audit exposure.`,
                `Wells Fargo security posture: <strong>${sec.postureScore}/${sec.postureMax}</strong>. Compliance gaps present an opportunity for security assessment services.`
            ) + `<br><br>`;

            anomalies.forEach(a => {
                html += `‚Ä¢ <strong>${a.severity}:</strong> ${a.description} <span style="opacity:.5">(${a.detectedDate})</span><br>`;
            });
            html += `‚Ä¢ <strong>PCI-DSS:</strong> ${sec.compliance.pciDss.status} ‚Äî ${sec.compliance.pciDss.findings} findings. ${sec.compliance.pciDss.details}<br>`;
            html += `‚Ä¢ <strong>SOX:</strong> ${sec.compliance.sox.status} ‚Äî ${sec.compliance.sox.findings} findings. ${sec.compliance.sox.details}<br>`;

            html += '<br>' + _tone(
                `The ${anomalies[0].severity.toLowerCase()}-severity anomaly from ${anomalies[0].detectedDate} is the top priority. Want me to investigate further or open a remediation task?`,
                `The compliance gaps are the most business-critical items here. Want me to prepare an audit-readiness brief?`,
                `Compliance gaps and the posture score are good conversation starters. Want me to prepare a security health review for the customer?`
            );
            return html;
        }

        function _assetCategory() {
            const a = ciscoIQData.assets;
            const sorted = [...a].sort((x, y) => x.healthScore - y.healthScore);
            const eol = a.filter(d => d.lifecycleStatus === 'End of Life');
            const eos = a.filter(d => d.lifecycleStatus === 'End of Sale');
            const avgHealth = Math.round(a.reduce((s, d) => s + d.healthScore, 0) / a.length);
            const dcs = [...new Set(a.map(d => d.datacenter))].length;

            let html = _tone(
                `You have <strong>${a.length} monitored devices</strong> across ${dcs} datacenters ‚Äî average health ${avgHealth}/100, with ${eol.length} End of Life and ${eos.length} End of Sale.`,
                `<strong>${a.length} devices</strong> across ${dcs} datacenters. Average health ${avgHealth}/100. <strong>${eol.length} EOL devices</strong> are no longer receiving security patches ‚Äî operational risk.`,
                `Wells Fargo has <strong>${a.length} devices</strong> across ${dcs} datacenters (avg health ${avgHealth}/100). <strong>${eol.length} EOL</strong> and ${eos.length} EOS devices present refresh opportunity.`
            ) + `<br><br>`;

            sorted.slice(0, 5).forEach(d => {
                const flag = d.lifecycleStatus === 'End of Life' ? ' ‚ö†Ô∏è EOL' : d.lifecycleStatus === 'End of Sale' ? ' ‚ö†Ô∏è EOS' : '';
                html += `‚Ä¢ <strong>${d.name}</strong> (${d.model}, ${d.datacenter}) ‚Äî Health ${d.healthScore}${flag}<br>`;
            });

            if (eol.length > 0) {
                html += '<br>' + _tone(
                    `The ${eol.length} EOL device${eol.length > 1 ? 's' : ''} (${eol.map(d => d.name).join(', ')}) no longer receive${eol.length === 1 ? 's' : ''} security patches. Want me to build a refresh plan or check contract coverage?`,
                    `The ${eol.length} EOL devices create security and compliance exposure. Want me to model refresh costs and timeline for budget planning?`,
                    `${eol.length} EOL devices are a hardware refresh opportunity. Want me to prepare a refresh proposal with migration options?`
                );
            } else {
                html += `<br>No EOL devices ‚Äî estate is in good shape. Want a detailed health breakdown by datacenter?`;
            }
            return html;
        }

        function _assessmentCategory() {
            const asmts = ciscoIQData.assessments;
            const sorted = [...asmts.misconfigurations].sort((a, b) => _sevRank[a.riskLevel] - _sevRank[b.riskLevel]);

            let html = _tone(
                `Last assessment <strong>(${asmts.lastAssessmentDate})</strong> found ${sorted.length} misconfigurations, with ${asmts.configDriftCount} devices drifted from golden config.`,
                `Assessment from <strong>${asmts.lastAssessmentDate}</strong>: ${sorted.length} misconfigurations found, ${asmts.configDriftCount} devices off golden config. This creates compliance and operational risk.`,
                `Wells Fargo assessment (${asmts.lastAssessmentDate}): ${sorted.length} misconfigurations, ${asmts.configDriftCount} config drift. Remediation engagement opportunity.`
            ) + `<br><br>`;

            sorted.slice(0, 5).forEach(m => {
                html += `‚Ä¢ <strong>${m.deviceName}</strong> ‚Äî ${m.riskLevel}: ${m.issue}<br>`;
            });

            html += '<br>' + _tone(
                `The ${sorted[0].riskLevel.toLowerCase()}-risk finding on ${sorted[0].deviceName} is the most urgent. Want me to push a fix, open a change request, or run a fresh assessment?`,
                `The ${sorted[0].riskLevel.toLowerCase()}-risk finding on ${sorted[0].deviceName} should be remediated before the next audit window. Want me to prepare a remediation timeline?`,
                `Start with the ${sorted[0].riskLevel.toLowerCase()}-risk finding on ${sorted[0].deviceName} for quick customer value. Want me to draft a config optimization proposal?`
            );
            return html;
        }

        function _casesCategory() {
            const cases = ciscoIQData.supportCases;
            const s1s2 = cases.filter(c => c.severity === 'S1' || c.severity === 'S2');
            const sorted = [...cases].sort((a, b) => (_sevRank[a.severity] - _sevRank[b.severity]) || (b.daysOpen - a.daysOpen));
            const aging = s1s2.filter(c => c.daysOpen >= 14);

            let html = _tone(
                `You have <strong>${cases.length} open TAC cases</strong> ‚Äî ${s1s2.length} at S1/S2 severity.`,
                `<strong>${cases.length} open TAC cases</strong>, ${s1s2.length} at critical severity. ${aging.length > 0 ? `${aging.length} case${aging.length > 1 ? 's' : ''} aging beyond SLA ‚Äî operational risk.` : ''}`,
                `Wells Fargo has <strong>${cases.length} open TAC cases</strong> (${s1s2.length} S1/S2). ${aging.length > 0 ? `${aging.length} aging beyond 2 weeks ‚Äî customer satisfaction risk.` : ''}`
            );
            if (activeViewPersona === 'engineer' && aging.length > 0) {
                html += ` <strong>${aging.length}</strong> ha${aging.length > 1 ? 've' : 's'} been open over 2 weeks.`;
            }
            html += `<br><br>`;

            sorted.slice(0, 5).forEach(c => {
                const flag = (c.severity === 'S1' || c.severity === 'S2') && c.daysOpen >= 14 ? ' ‚ö†Ô∏è' : '';
                html += `‚Ä¢ <strong>${c.caseNumber}</strong> (${c.severity}) ‚Äî ${c.title.substring(0, 65)}${c.title.length > 65 ? '‚Ä¶' : ''}, ${c.daysOpen}d, <em>${c.status}</em>${flag}<br>`;
            });

            const worst = sorted[0];
            html += '<br>' + _tone(
                `${worst.caseNumber} is the highest priority. Want me to escalate, request a callback from ${worst.assignedEngineer}, or attach diagnostics?`,
                `${worst.caseNumber} poses the highest operational risk. Want me to prepare an escalation brief or impact assessment?`,
                `${worst.caseNumber} is the top customer concern. Want me to coordinate an escalation or prepare a proactive status update?`
            );
            return html;
        }

        function _renewalsCategory() {
            const r = ciscoIQData.renewals;
            const sorted = [...r].sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));
            const totalValue = r.reduce((s, c) => s + c.annualValue, 0);
            const soonest = _daysUntil(sorted[0].expiryDate);

            let html = _tone(
                `<strong>${r.length} contracts</strong> approaching renewal ‚Äî combined annual value ${_fmtDollars(totalValue)}. Soonest expires in ${soonest} days.`,
                `<strong>${_fmtDollars(totalValue)}</strong> in annual contract value approaching renewal. ${r.length} contracts, soonest in ${soonest} days. Budget authorization needed.`,
                `<strong>${_fmtDollars(totalValue)}</strong> in renewal opportunity across ${r.length} contracts. Soonest expires in ${soonest} days ‚Äî proactive engagement recommended.`
            ) + `<br><br>`;

            sorted.forEach(c => {
                const d = _daysUntil(c.expiryDate);
                const label = c.productName.length > 55 ? c.productName.substring(0, 55) + '‚Ä¶' : c.productName;
                html += `‚Ä¢ <strong>${c.contractId}</strong> ‚Äî ${label}, expires ${c.expiryDate} (${d}d), ${_fmtDollars(c.annualValue)}/yr<br>`;
            });

            html += '<br>' + _tone(
                `The ${sorted[0].contractId.split('-').slice(-1)[0]} contract is the most time-sensitive. Want me to generate renewal quotes with co-term options or route to Procurement?`,
                `The ${sorted[0].contractId.split('-').slice(-1)[0]} contract needs immediate attention. Want me to model 1/3/5-year options with budget impact?`,
                `${sorted[0].contractId.split('-').slice(-1)[0]} is the most time-sensitive deal. Want me to prepare a renewal proposal with co-term savings analysis?`
            );
            return html;
        }

        function _prioritiesDigest() {
            const topVuln = [...ciscoIQData.vulnerabilities].sort((a, b) => (_sevRank[a.severity] - _sevRank[b.severity]) || (b.daysOpen - a.daysOpen))[0];
            const topMisconfig = [...ciscoIQData.assessments.misconfigurations].sort((a, b) => _sevRank[a.riskLevel] - _sevRank[b.riskLevel])[0];
            const topCase = [...ciscoIQData.supportCases].filter(c => c.severity === 'S1' || c.severity === 'S2').sort((a, b) => b.daysOpen - a.daysOpen)[0];
            const topRenewal = [...ciscoIQData.renewals].sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate))[0];
            const sec = ciscoIQData.security;
            const critAnomaly = [...sec.recentAnomalies].sort((a, b) => _sevRank[a.severity] - _sevRank[b.severity])[0];
            const totalRenewalValue = ciscoIQData.renewals.reduce((s, c) => s + c.annualValue, 0);

            let html = _tone(
                `Here's your cross-domain priority digest ‚Äî items that need attention right now.`,
                `Here's your executive summary ‚Äî key risks and actions across the Cisco estate.`,
                `Here's the Wells Fargo customer health summary ‚Äî key risks and partner action items.`
            ) + `<br><br>`;

            html += _tone(
                `üî¥ <strong>Vulnerabilities:</strong> ${ciscoIQData.vulnerabilities.filter(v => v.severity === 'Critical').length} critical CVEs open, longest is ${topVuln.cveId} (${topVuln.daysOpen} days, ${topVuln.affectedDevices.length} devices). Remediation overdue.<br>`,
                `üî¥ <strong>Security Risk:</strong> ${ciscoIQData.vulnerabilities.filter(v => v.severity === 'Critical').length} critical CVEs unpatched across production. Posture score ${sec.postureScore}/100. Audit exposure increasing.<br>`,
                `üî¥ <strong>Customer Risk:</strong> ${ciscoIQData.vulnerabilities.filter(v => v.severity === 'Critical').length} critical CVEs unpatched, posture ${sec.postureScore}/100. Proactive remediation strengthens relationship.<br>`
            );
            html += _tone(
                `üü° <strong>Config Risk:</strong> ${topMisconfig.riskLevel} misconfiguration on ${topMisconfig.deviceName} ‚Äî ${topMisconfig.issue.toLowerCase()}<br>`,
                `üü° <strong>Compliance:</strong> PCI-DSS ${sec.compliance.pciDss.status} (${sec.compliance.pciDss.findings} findings), SOX ${sec.compliance.sox.status}. Audit window approaching.<br>`,
                `üü° <strong>Renewal Pipeline:</strong> ${_fmtDollars(totalRenewalValue)} across ${ciscoIQData.renewals.length} contracts. Soonest in ${_daysUntil(topRenewal.expiryDate)} days ‚Äî outreach recommended.<br>`
            );
            html += _tone(
                `üîµ <strong>Support:</strong> TAC case ${topCase.caseNumber} (${topCase.severity}) open ${topCase.daysOpen} days ‚Äî <em>${topCase.status}</em>.<br>`,
                `üîµ <strong>Operations:</strong> TAC case ${topCase.caseNumber} (${topCase.severity}) open ${topCase.daysOpen} days ‚Äî SLA risk. <em>${topCase.status}</em>.<br>`,
                `üîµ <strong>Escalations:</strong> ${topCase.caseNumber} (${topCase.severity}) open ${topCase.daysOpen} days ‚Äî <em>${topCase.status}</em>. Customer satisfaction at risk.<br>`
            );
            html += _tone(
                `üü£ <strong>Contracts:</strong> ${topRenewal.contractId} (${_fmtDollars(topRenewal.annualValue)}/yr) expires in ${_daysUntil(topRenewal.expiryDate)} days ‚Äî renewal not yet initiated.<br>`,
                `üü£ <strong>Financial:</strong> ${_fmtDollars(totalRenewalValue)}/yr in contract value at risk within 90 days. Budget authorization needed.<br>`,
                `üü£ <strong>Growth:</strong> ${ciscoIQData.assets.filter(d => d.lifecycleStatus === 'End of Life').length} EOL devices = refresh opportunity. Combine with renewals for co-term savings.<br>`
            );
            html += _tone(
                `‚ö†Ô∏è <strong>Security Posture:</strong> Score ${sec.postureScore}/${sec.postureMax}. ${critAnomaly.description.split(' on ')[0]} detected ${critAnomaly.detectedDate}.<br>`,
                `‚ö†Ô∏è <strong>Posture Score:</strong> ${sec.postureScore}/${sec.postureMax} ‚Äî below 75 target. Board reporting threshold breached.<br>`,
                `‚ö†Ô∏è <strong>Health Score:</strong> Posture ${sec.postureScore}/${sec.postureMax}. Combined with open CVEs, recommend scheduling a Cisco CX health review.<br>`
            );

            html += '<br>' + _tone(
                `I'd start with the config fix on ${topMisconfig.deviceName} (quick win, high risk) and the contract renewal (time-sensitive). Want me to take action on any of these?`,
                `Top actions: authorize the ${topRenewal.contractId.split('-').slice(-1)[0]} renewal and schedule the compliance remediation. Want me to prepare a decision brief?`,
                `Recommended partner actions: proactive renewal outreach on ${_fmtDollars(topRenewal.annualValue)} contract and a remediation services proposal. Want me to draft both?`
            );
            return html;
        }

        // ‚îÄ‚îÄ‚îÄ Unified Smart Response Router ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function generateSmartResponse(userQuestion) {
            const q = userQuestion.toLowerCase();

            // ‚îÄ‚îÄ Single-item lookups first (work even before persona selection) ‚îÄ‚îÄ
            const cveMatch = userQuestion.match(/CVE-[\d-]+/i);
            if (cveMatch) {
                const cve = ciscoIQData.vulnerabilities.find(v => v.cveId.toLowerCase() === cveMatch[0].toLowerCase());
                if (cve) return { text: _cveDetail(cve), showInfo: false };
            }

            const srMatch = userQuestion.match(/SR-\d+/i);
            if (srMatch) {
                const sr = ciscoIQData.supportCases.find(c => c.caseNumber === srMatch[0]);
                if (sr) return { text: _caseDetail(sr), showInfo: false };
            }

            const conMatch = userQuestion.match(/CON-[\w-]+/i);
            if (conMatch) {
                const con = ciscoIQData.renewals.find(r => r.contractId === conMatch[0]);
                if (con) return { text: _renewalDetail(con), showInfo: false };
            }

            const deviceMisconfig = ciscoIQData.assessments.misconfigurations.find(m => q.includes(m.deviceName.toLowerCase()));
            if (deviceMisconfig && (q.includes('misconfig') || q.includes('config') || q.includes('finding') || q.includes('risk'))) {
                return { text: _misconfigDetail(deviceMisconfig), showInfo: false };
            }

            // ‚îÄ‚îÄ Category-level data queries (also work before persona selection) ‚îÄ‚îÄ
            if (q.includes('vulnerabilit') || q.includes('cve') || q.includes('psirt') || q.includes('patch')) {
                return { text: _vulnCategory(), showInfo: false };
            }

            if (q.includes('security') || q.includes('posture') || q.includes('compliance') || q.includes('pci') || q.includes('sox') || q.includes('anomal')) {
                return { text: _securityCategory(), showInfo: false };
            }

            if (q.includes('asset') || q.includes('device') || q.includes('inventory') || q.includes('hardware') || q.includes('eol') || q.includes('end of life')) {
                return { text: _assetCategory(), showInfo: false };
            }

            if (q.includes('assessment') || q.includes('misconfiguration') || q.includes('misconfig') || q.includes('config drift') || q.includes('drift')) {
                return { text: _assessmentCategory(), showInfo: false };
            }

            if (q.includes('case') || q.includes('tac') || q.includes('support') || q.includes('escalation')) {
                return { text: _casesCategory(), showInfo: false };
            }

            if (q.includes('renewal') || q.includes('contract') || q.includes('expir') || q.includes('license') || q.includes('renewal opportunit')) {
                return { text: _renewalsCategory(), showInfo: false };
            }

            if (q.includes('attention') || q.includes('priorit') || q.includes('summary') || q.includes('what needs') || q.includes('/priorities') || q.includes('overview') || q.includes('digest') || q.includes('customer health') || q.includes('executive summary')) {
                return { text: _prioritiesDigest(), showInfo: false };
            }

            // ‚îÄ‚îÄ Generic fallback ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
            return {
                text: _tone(
                    `I can pull live data on <strong>vulnerabilities</strong>, <strong>assets</strong>, <strong>security posture</strong>, <strong>TAC cases</strong>, <strong>config assessments</strong>, and <strong>contract renewals</strong>. Try asking about any of those, or say <em>"what needs my attention"</em> for a full priorities digest.`,
                    `I can surface <strong>risk exposure</strong>, <strong>contract status</strong>, <strong>compliance gaps</strong>, <strong>operational issues</strong>, and <strong>financial impact</strong>. Try asking about any of those, or say <em>"executive summary"</em> for a full overview.`,
                    `I can show <strong>customer health</strong>, <strong>renewal opportunities</strong>, <strong>open escalations</strong>, <strong>remediation gaps</strong>, and <strong>growth potential</strong>. Try asking about any of those, or say <em>"review customer health"</em> for a full summary.`
                ),
                showInfo: false
            };
        }

        function sendCustomMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addMessage('user', message);
            input.value = '';

            // Generate and show assistant response
            setTimeout(() => {
                const typing = showTypingIndicator();
                setTimeout(() => {
                    typing.remove();
                    const response = generateSmartResponse(message);

                    // Create custom message with info box
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'message assistant';

                    let html = `
                        <div class="message-header">
                            <div class="avatar">C</div>
                            <div class="role-label">Cisco AI Assistant</div>
                            <div class="message-time">${getCurrentTime()}</div>
                        </div>
                        <div class="message-bubble">${response.text}</div>
                    `;

                    if (response.showInfo) {
                        html += `
                            <div class="info-message" style="margin-left: 48px;">
                                <strong>üí° Demo Mode</strong>
                                This is a prototype showcasing key capabilities. In production, I would provide real-time analysis of your actual infrastructure, with live data from Cisco DNA Center, vManage, SecureX, and Smart Licensing.
                            </div>
                        `;
                    }

                    messageDiv.innerHTML = html;
                    chatContainer.appendChild(messageDiv);
                    scrollToBottom();
                }, 1200);
            }, 600);
        }

        // Add Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('messageInput');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendCustomMessage();
                    }
                });
            }
        });

        // ‚îÄ‚îÄ‚îÄ Proactive Insight Panel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function initAttentionPanel() {
            const container = document.getElementById('attentionCards');
            if (!container) return;

            // Shared data lookups
            const topVuln = [...ciscoIQData.vulnerabilities]
                .sort((a, b) => (_sevRank[a.severity] - _sevRank[b.severity]) || (b.daysOpen - a.daysOpen))[0];
            const topMisconfig = [...ciscoIQData.assessments.misconfigurations]
                .sort((a, b) => _sevRank[a.riskLevel] - _sevRank[b.riskLevel])[0];
            const s1s2Cases = ciscoIQData.supportCases.filter(c => c.severity === 'S1' || c.severity === 'S2');
            const topCase = [...s1s2Cases].sort((a, b) => b.daysOpen - a.daysOpen)[0];
            const topRenewal = [...ciscoIQData.renewals]
                .sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate))[0];
            const sec = ciscoIQData.security;
            const totalRenewalValue = ciscoIQData.renewals.reduce((s, c) => s + c.annualValue, 0);
            const eolDevices = ciscoIQData.assets.filter(d => d.lifecycleStatus === 'End of Life');
            const avgHealth = Math.round(ciscoIQData.assets.reduce((s, d) => s + d.healthScore, 0) / ciscoIQData.assets.length);
            const critCVEs = ciscoIQData.vulnerabilities.filter(v => v.severity === 'Critical').length;

            let cards;

            if (activeViewPersona === 'engineer') {
                // Technical focus: CVE severity + misconfiguration risk
                cards = [
                    { cls: 'severity-critical', icon: 'üî¥',
                      headline: topVuln.cveId,
                      summary: `${topVuln.severity} ¬∑ ${topVuln.affectedDevices.length} devices ¬∑ open ${topVuln.daysOpen}d`,
                      query: `Tell me more about vulnerability ${topVuln.cveId} and its remediation plan` },
                    { cls: 'severity-misconfig', icon: 'üü°',
                      headline: topMisconfig.deviceName,
                      summary: topMisconfig.issue,
                      query: `Tell me more about the ${topMisconfig.riskLevel}-risk misconfiguration on ${topMisconfig.deviceName}` },
                    { cls: 'severity-support', icon: 'üîµ',
                      headline: topCase.caseNumber,
                      summary: `${topCase.severity} ¬∑ ${topCase.daysOpen}d ¬∑ ${topCase.status}`,
                      query: `Tell me more about TAC case ${topCase.caseNumber} and its current status` },
                    { cls: 'severity-renewal', icon: 'üü£',
                      headline: 'Contract Expiring',
                      summary: `${topRenewal.contractId} ¬∑ ${_fmtDollars(topRenewal.annualValue)} ¬∑ ${_daysUntil(topRenewal.expiryDate)}d left`,
                      query: `Tell me more about the expiring contract ${topRenewal.contractId} for ${topRenewal.productName}` }
                ];
            } else if (activeViewPersona === 'director') {
                // Business focus: posture score + contract value at risk
                cards = [
                    { cls: 'severity-critical', icon: 'üî¥',
                      headline: `Posture: ${sec.postureScore}/100`,
                      summary: `Below 75 target ¬∑ PCI-DSS ${sec.compliance.pciDss.status} ¬∑ ${sec.compliance.pciDss.findings} findings`,
                      query: `Show me our security posture and compliance status` },
                    { cls: 'severity-misconfig', icon: 'üü°',
                      headline: `${_fmtDollars(totalRenewalValue)} At Risk`,
                      summary: `${ciscoIQData.renewals.length} contracts ¬∑ soonest in ${_daysUntil(topRenewal.expiryDate)}d`,
                      query: `Show me the contracts and renewals coming up` },
                    { cls: 'severity-support', icon: 'üîµ',
                      headline: `${topCase.severity} Case Aging`,
                      summary: `${topCase.caseNumber} ¬∑ ${topCase.daysOpen}d without resolution ¬∑ ${topCase.status}`,
                      query: `Tell me more about TAC case ${topCase.caseNumber} and its current status` },
                    { cls: 'severity-renewal', icon: 'üü£',
                      headline: 'Compliance Gap',
                      summary: `PCI-DSS: ${sec.compliance.pciDss.findings} findings ¬∑ SOX: ${sec.compliance.sox.findings} findings`,
                      query: `Show me our security posture and compliance status` }
                ];
            } else {
                // Relationship focus: customer health + renewal opportunity
                cards = [
                    { cls: 'severity-critical', icon: 'üî¥',
                      headline: `Health: ${avgHealth}/100`,
                      summary: `${critCVEs} critical CVEs ¬∑ posture ${sec.postureScore}/100 ¬∑ ${eolDevices.length} EOL devices`,
                      query: `What needs my attention for this customer` },
                    { cls: 'severity-misconfig', icon: 'üü°',
                      headline: `${_fmtDollars(totalRenewalValue)} Renewals`,
                      summary: `${ciscoIQData.renewals.length} contracts ¬∑ soonest in ${_daysUntil(topRenewal.expiryDate)}d`,
                      query: `Show me the contracts and renewals coming up` },
                    { cls: 'severity-support', icon: 'üîµ',
                      headline: `${s1s2Cases.length} Escalations`,
                      summary: `Longest: ${topCase.caseNumber} ¬∑ ${topCase.daysOpen}d ¬∑ ${topCase.status}`,
                      query: `Show me the open TAC cases and support status` },
                    { cls: 'severity-renewal', icon: 'üü£',
                      headline: `${eolDevices.length} EOL Refresh`,
                      summary: `${eolDevices.map(d => d.name).join(', ')} ‚Äî upgrade opportunity`,
                      query: `Show me the device inventory and asset health` }
                ];
            }

            container.innerHTML = cards.map(c => `
                <div class="attention-card ${c.cls}">
                    <div class="card-icon">${c.icon}</div>
                    <div class="card-headline">${c.headline}</div>
                    <div class="card-summary">${c.summary}</div>
                    <button class="card-action" onclick="handleAttentionClick('${c.query.replace(/'/g, "\\'")}')">View Details</button>
                </div>
            `).join('');
        }

        function handleAttentionClick(query) {
            // Pipe through the normal chat flow so the unified router handles it
            const input = document.getElementById('messageInput');
            input.value = query;
            sendCustomMessage();
        }

        function initChat() {
            const config = viewPersonaConfig[activeViewPersona];
            const typing = showTypingIndicator();
            setTimeout(() => {
                typing.remove();
                // Build persona-specific greeting with data-driven suggestion buttons
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message assistant';
                let html = `
                    <div class="message-header">
                        <div class="avatar">C</div>
                        <div class="role-label">Cisco AI Assistant</div>
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                    <div class="message-bubble">${config.greeting}</div>
                    <div class="suggestions">
                `;
                config.suggestions.forEach(s => {
                    html += `<button class="suggestion-btn" onclick="handleAttentionClick('${s.replace(/'/g, "\\'")}')">${s}</button>`;
                });
                html += '</div>';
                messageDiv.innerHTML = html;
                chatContainer.appendChild(messageDiv);
                scrollToBottom();
            }, 1200);
        }

        function switchViewPersona(persona) {
            if (persona === activeViewPersona) return;
            activeViewPersona = persona;

            // Update tab styling
            document.querySelectorAll('.persona-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.persona === persona);
            });

            // Map to a conversation persona for the guided flow fallback
            currentPersona = viewPersonaConfig[persona].mappedPersona;
            conversation = personaConversations[currentPersona] || [];
            currentStep = 0;

            // Reset chat and reprioritize cards
            chatContainer.innerHTML = '';
            initAttentionPanel();
            initChat();
        }

        // Initialize on page load ‚Äî default to Network Engineer
        currentPersona = viewPersonaConfig[activeViewPersona].mappedPersona;
        conversation = personaConversations[currentPersona] || [];
        initAttentionPanel();
        initChat();
        initVoiceRecognition();
    </script>
</body>
</html>
